{% extends "dashboard/base.html" %}

{% block title %}Register for Exams - Exam Registration System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card shadow-sm">
            <div class="card-body">
                <h4 class="card-title fw-bold mb-4">Register for Exams</h4>
                
                <form method="POST" action="{{ url_for('exams.register') }}" id="registerForm">
                    <div class="mb-3">
                        <label for="department_id" class="form-label">Select Department</label>
                        <select class="form-select" name="department_id" id="department_id" required>
                            <option value="">Choose department...</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}">{{ dept.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="degree_type" class="form-label">Degree/Diploma</label>
                        <select class="form-select" name="degree_type" id="degree_type">
                            <option value="Degree">Degree</option>
                            <option value="Diploma">Diploma</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Select Courses</label>
                        <div id="coursesContainer">
                            <p class="text-muted">Please select a department first</p>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="academic_year" class="form-label">Academic Year</label>
                        <select class="form-select" name="academic_year" id="academic_year">
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="exam_date" class="form-label">Choose date</label>
                        <input type="date" class="form-control" name="exam_date" id="exam_date" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#department_id').change(function() {
        var departmentId = $(this).val();
        if (departmentId) {
            $.ajax({
                url: '/exams/api/courses/' + departmentId,
                type: 'GET',
                success: function(courses) {
                    var html = '';
                    courses.forEach(function(course) {
                        html += '<div class="form-check mb-2">';
                        html += '<input class="form-check-input" type="checkbox" name="course_ids" value="' + course.id + '" id="course_' + course.id + '">';
                        html += '<label class="form-check-label" for="course_' + course.id + '">';
                        html += course.code + ' - ' + course.name + ' (' + course.credits + ' credits)';
                        html += '</label>';
                        html += '</div>';
                    });
                    $('#coursesContainer').html(html);
                },
                error: function() {
                    $('#coursesContainer').html('<p class="text-danger">Error loading courses</p>');
                }
            });
        } else {
            $('#coursesContainer').html('<p class="text-muted">Please select a department first</p>');
        }
    });
});
</script>
{% endblock %}
